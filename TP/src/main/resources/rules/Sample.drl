package com.sample

import logic.*;
import java.util.Scanner;
 
  /*
rule "nome"
    when

    then

end
*/

// REGRAS SEM DIAGNOSTICOS ANTERIORES

rule "Paciente tem 1 nodulo menor de 1cm"
salience 90
	when
		$p:Paciente (getSizeHistorico() == 1)
		$d:Diagnostico(getNodulos() == 1 && getNodulo(0).getTam() < 1)
	then
		System.out.println("Repetir ultrassom em 4 meses");
end

rule "Paciente tem nodulo entre 1 a 2 cm"
salience 90	
	when
		$p:Paciente (getSizeHistorico() == 1)
		forall($n:Nodulo(getTam()>=1 && getTam()<2))
	then
		if ($p.historico.get(0).getFourPhaseCT() >= 1){
			System.out.println("HCC1");
			$p.getDiagnostico(0).setResultado(true);
		}else
			if($p.historico.get(0).getBiopsia() == true){
				System.out.println("HCC2");
				$p.getDiagnostico(0).setResultado(true);
			}else{
				System.out.println("Inconclusivo!");
				System.out.println("Repetir ultrassom em 4 meses");
		}
end

rule "Paciente tem nodulo maior ou igual a 2 cm"
salience 90	
	when
		$p:Paciente (getSizeHistorico() == 1)
		Paciente(getDiagnostico(0).getNodulo(0).getTam() >= 2 || getDiagnostico(0).getNodulo(1).getTam() >= 2 || getDiagnostico(0).getNodulo(2).getTam() >= 2)
	then
		if ($p.historico.get(0).getFourPhaseCT() >= 1){
			System.out.println("HCC3");
			$p.getDiagnostico(0).setResultado(true);
		}else
			if($p.historico.get(0).getBiopsia() == true){
				System.out.println("HCC4");
				$p.getDiagnostico(0).setResultado(true);
			}else{
				System.out.println("Inconclusivo!");
				System.out.println("Repetir ultrassom em 4 meses");
		}
end

rule "Stage 0"
salience 85
	when
		$p:Paciente(getSizeHistorico() == 1, 
		getDiagnostico(0).getNodulos() == 1, 
		getDiagnostico(0).getNodulo(0).getTam()<2, 
		getDiagnostico(0).getFeelsWell()==true && getDiagnostico(0).getLiverWorksNormally()==true)
	then
		$p.setStage('0');
end

rule "Stage A single tumor"
salience 85
	when
		$p:Paciente(getSizeHistorico() == 1,
		getDiagnostico(0).getNodulos() == 1,
		getDiagnostico(0).getNodulo(0).getTam() < 5 && getStage() != '0')
			Paciente(getDiagnostico(0).getFeelsWell()==true && getDiagnostico(0).getLiverWorksNormally()==true)
	then
		$p.setStage('A');
end

rule "Stage A multiple tumor"
salience 85
	when
		$p:Paciente(getSizeHistorico() == 1, getDiagnostico(0).getNodulos() <= 3, getDiagnostico(0).getFeelsWell()==true && getDiagnostico(0).getLiverWorksNormally()==true)
			Paciente(getDiagnostico(0).getNodulo(0).getTam()<3, getDiagnostico(0).getNodulo(1).getTam()<3, getDiagnostico(0).getNodulo(2).getTam()<3)
	then
		$p.setStage('A');
end

rule "Stage B"
salience 85
	when
		$p:Paciente(historico.size() == 1, getStage()!='0' && getStage()!='A')
			Paciente(getDiagnostico(0).getFeelsWell()==true && getDiagnostico(0).getLiverWorksNormally()==true)
	then
		$p.setStage('B');
end

rule "Stage C"
salience 85
	when
		$p:Paciente(historico.size() == 1)
			Paciente((getDiagnostico(0).getHasSpread() == true || getDiagnostico(0).getFeelsWell() == false) && getDiagnostico(0).getLiverWorksNormally()==true) 
	then
		$p.setStage('C');
end

rule "Stage D"
salience 85
	when
		$p:Paciente(historico.size() == 1)
			Paciente(getDiagnostico(0).getSevereLiverDamage == true || getDiagnostico(0).getNeedsHelp == true)
	then
		$p.setStage('D');
end

rule "Very early stage single"
salience 80
	when
		$p:Paciente (historico.size()== 1)
			Paciente (getStage()== '0')
			Paciente(getDiagnostico(0).getNodulos()== 1)
	then
		if ($p.getDiagnostico(0).getPortalSpread() == false){
			System.out.println("RESSECTION");
			$p.setNomeTratamento("Ressection");
		}else
			if ($p.getDiagnostico(0).getHasAssociatedDiseases() == false){
				System.out.println("Liver Transplantation CLT/LDLT1");
				$p.setNomeTratamento("Liver Transplantation CLT/LDLT");
			}else{
				System.out.println("Radiofrequency ablation RF/PEI");
				$p.setNomeTratamento("RF/PEI");
			}
end

rule "Very early stage multiple"
salience 80
	when
		$p:Paciente (historico.size() == 1)
			Paciente (getStage()=='0')
			Paciente(getDiagnostico(0).getNodulos()>1)
	then
		if ($p.getDiagnostico(0).getHasAssociatedDiseases() == false){
			System.out.println("Liver Transplantation CLT/LDLT2");
			$p.setNomeTratamento("Liver Transplantation CLT/LDLT");
		}else{
			System.out.println("Radiofrequency ablation RF/PEI");
			$p.setNomeTratamento("RF/PEI");
		}
end

rule "Early stage"
salience 80
	when
		$p:Paciente (historico.size() == 1)
			Paciente (getStage()=='A')
			Paciente(getDiagnostico(0).getNodulos()>1)
	then
		if ($p.getDiagnostico(0).getHasAssociatedDiseases() == false){
			System.out.println("Liver Transplantation CLT/LDLT3");
			$p.setNomeTratamento("Liver Transplantation CLT/LDLT");
		}else{
			System.out.println("Radiofrequency ablation RF/PEI");
			$p.setNomeTratamento("RF/PEI");
		}
end

rule "Intermediate stage"
salience 80
	when
		$p:Paciente (historico.size() == 1)
			Paciente (getStage()=='B')
	then
		System.out.println("Transarterial chemoembolization for liver cancer (TACE)");
		$p.setNomeTratamento("TACE");
end

rule "Advanced stage"
salience 80
	when
		$p:Paciente (historico.size() == 1)
			Paciente (getStage()=='C')
	then
		System.out.println("Sorafenib");
		$p.setNomeTratamento("Sorafenib");
end

rule "Terminal stage"
salience 80
	when 
		$p:Paciente (historico.size() == 1)
		   Paciente (getStage()=='D')
	then
		System.out.println("Best supportive care");
		$p.setNomeTratamento("Best supportive care");
end

// REGRAS QUANDO EXISTIREM DIAGNOSTICOS ANTERIORES